## Context

MetaCubeXD 目前只在用户主动测试时检查节点状态，缺乏主动监控能力。项目是纯前端应用，需要依赖浏览器 API 实现后台检查和通知推送。

## Goals / Non-Goals

**Goals:**

- 实现定时自动健康检查
- 提供节点状态监控面板
- 支持浏览器通知告警
- 记录节点可用性历史

**Non-Goals:**

- 不实现真正的后台服务（依赖浏览器标签页保持打开）
- 不支持 SMS/邮件等外部通知渠道
- 不实现自动故障转移（由 Mihomo 核心处理）

## Decisions

### 1. 健康检查机制

**决定**: 使用 `setInterval` 定时调用延迟测试 API，默认间隔 5 分钟。

**理由**:

- 简单可靠
- 复用现有延迟测试逻辑
- 用户可配置间隔

**备选方案**:

- Service Worker 后台检查 - 浏览器支持不一致，实现复杂
- Web Worker - 仍需页面保持打开

### 2. 检查范围

**决定**: 只检查当前激活的节点，可选检查收藏节点。

**理由**:

- 减少不必要的请求
- 用户最关心的是正在使用的节点

### 3. 通知方案

**决定**: 使用 Web Notifications API 推送浏览器通知。

**理由**:

- 原生支持，无需额外依赖
- 用户可在系统级别管理权限
- 支持桌面和移动端

### 4. 可用性判定

**决定**:

- 健康：延迟 < 超时阈值（默认 5000ms）
- 异常：延迟 > 警告阈值（默认 2000ms）
- 不可用：测试失败或超时

**理由**:

- 分级提供更细粒度的状态
- 阈值可配置

## Risks / Trade-offs

| 风险                 | 缓解措施                      |
| -------------------- | ----------------------------- |
| 频繁检查增加资源消耗 | 提供检查间隔配置，默认 5 分钟 |
| 浏览器标签页后台限制 | 显示提示，建议保持标签页可见  |
| 通知权限被拒绝       | 提供应用内告警作为备选        |
| 误报（临时网络波动） | 连续 N 次失败才触发告警       |
